<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>soprano.hpc.submitter package &mdash; Soprano 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Soprano 0.1 documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-soprano.hpc.submitter">
<span id="soprano-hpc-submitter-package"></span><h1>soprano.hpc.submitter package<a class="headerlink" href="#module-soprano.hpc.submitter" title="Permalink to this headline">¶</a></h1>
<p>Classes and functions required for processes that automatically submit jobs
to a queueing system working in the background.</p>
<p>These can be launched interactively from the command line. In order to do
that:</p>
<ol class="arabic">
<li><p class="first">write your own implementation of a submitter class by inheriting from 
soprano.hpc.submitter.Submitter or use one of the provided ones;</p>
</li>
<li><p class="first">write an input file in which you simply create an instance of said class
and set up its parameters (ideally by calling the set_parameters method);</p>
</li>
<li><p class="first">launch that submitter from the command line with the following command:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">soprano.hpc.submitter</span> <span class="pre">start</span> <span class="pre">&lt;filename&gt;</span></code></p>
</div></blockquote>
</li>
</ol>
<p>You can have multiple submitter instances, even of different types, defined
in the same file: in that case you will need to use the -n option to specify
which one you want to launch (the name you need to use is the name of the 
<em>variable</em> you stored the instance in). If you are working on remote login and
you want to prevent the submitter from being terminated upon exiting your
session use the -nohup option.
To list which submitters from a given file are running, and how long have they
been running for, just use:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">soprano.hpc.submitter</span> <span class="pre">list</span> <span class="pre">&lt;filename&gt;</span></code></div></blockquote>
<p>Similarly, you can stop a running submitter with:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">soprano.hpc.submitter</span> <span class="pre">stop</span> <span class="pre">&lt;filename&gt;</span></code></div></blockquote>
<p>Submitters have a &#8216;name&#8217; property and will save a &lt;name&gt;.log file in which any
output from their run can be stored.</p>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-soprano.hpc.submitter.castep">
<span id="soprano-hpc-submitter-castep-module"></span><h2>soprano.hpc.submitter.castep module<a class="headerlink" href="#module-soprano.hpc.submitter.castep" title="Permalink to this headline">¶</a></h2>
<p>Definition of CastepSubmitter class.</p>
<p>A basic &#8220;rolling&#8221; submitter for Castep calculations, grabbing from one folder
and depositing results in another.</p>
<dl class="class">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter">
<em class="property">class </em><code class="descclassname">soprano.hpc.submitter.castep.</code><code class="descname">CastepSubmitter</code><span class="sig-paren">(</span><em>name</em>, <em>queue</em>, <em>submit_script</em>, <em>max_jobs=4</em>, <em>check_time=10</em>, <em>max_time=3600</em>, <em>temp_folder=None</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#soprano.hpc.submitter.submit.Submitter" title="soprano.hpc.submitter.submit.Submitter"><code class="xref py py-class docutils literal"><span class="pre">soprano.hpc.submitter.submit.Submitter</span></code></a></p>
<dl class="method">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter.finish_job">
<code class="descname">finish_job</code><span class="sig-paren">(</span><em>name</em>, <em>args</em>, <em>folder</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter.finish_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Save required output files to the output folder</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter.finish_run">
<code class="descname">finish_run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter.finish_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Try removing the temporary keywords directory</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter.next_job">
<code class="descname">next_job</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter.next_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Grab the next job from folder_in</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter.set_parameters">
<code class="descname">set_parameters</code><span class="sig-paren">(</span><em>folder_in, folder_out, castep_command, castep_path=None, copy_extensions=[u'.castep'], pspot_files=[], dryrun_test=False</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter.set_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the parameters of the CASTEP Submitter</p>
<div class="line-block">
<div class="line">Args:</div>
<div class="line-block">
<div class="line">folder_in (str): path of the folder to extract cell files from</div>
<div class="line">folder_out (str): path of the folder where the results will be</div>
<div class="line-block">
<div class="line">saved</div>
</div>
<div class="line">castep_command (str): command used to call the CASTEP executable</div>
<div class="line-block">
<div class="line">on this system</div>
</div>
<div class="line">castep_path (Optional[str]): folder where the CASTEP executable is</div>
<div class="line-block">
<div class="line">located (if not part of the system</div>
<div class="line">PATH)</div>
</div>
<div class="line">pspot_files (Optional[list[str]]): additional pseudopotential</div>
<div class="line-block">
<div class="line">files to be copied in the input</div>
<div class="line">temporary folders</div>
</div>
<div class="line">copy_extensions (Optional[list[str]]): extensions of output files</div>
<div class="line-block">
<div class="line">to copy to the output</div>
<div class="line">folder (by default only</div>
<div class="line">.castep file)</div>
</div>
<div class="line">dryrun_test (Optional[bool]): run a dryrun test on files before</div>
<div class="line-block">
<div class="line">actually running the calculation.</div>
<div class="line">Off by default.</div>
</div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter.setup_job">
<code class="descname">setup_job</code><span class="sig-paren">(</span><em>name</em>, <em>args</em>, <em>folder</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter.setup_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy files to temporary folder to prepare for execution</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.castep.CastepSubmitter.start_run">
<code class="descname">start_run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.castep.CastepSubmitter.start_run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-soprano.hpc.submitter.queues">
<span id="soprano-hpc-submitter-queues-module"></span><h2>soprano.hpc.submitter.queues module<a class="headerlink" href="#module-soprano.hpc.submitter.queues" title="Permalink to this headline">¶</a></h2>
<p>Definition of QueueInterface class.</p>
<dl class="class">
<dt id="soprano.hpc.submitter.queues.QueueInterface">
<em class="property">class </em><code class="descclassname">soprano.hpc.submitter.queues.</code><code class="descname">QueueInterface</code><span class="sig-paren">(</span><em>sub_cmd</em>, <em>list_cmd</em>, <em>kill_cmd</em>, <em>sub_outre</em>, <em>list_outre</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.queues.QueueInterface" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>QueueInterface object</p>
<p>A class meant to simplify interfacing in a basic way
with a Queue system. Contains commands to submit to the queue, list the
job IDs, and kill them if necessary. Will contain Regexps to parse for IDs
and additional information as returned upon submission and listing.
It is important that the regular expressions used employ NAMED GROUPS to
parse the various fields. In particular, a job_id group must ALWAYS be
present.
The class also provides some static variables implementing standard
interfaces for common queueing systems. These can be retrieved by using
QueueInterface.&lt;NAME&gt;. The currently implemented names are the following:</p>
<ul>
<li><p class="first">LSF (IBM&#8217;s managing system, using the command bsub)</p>
</li>
<li><dl class="first docutils">
<dt>GridEngine (Sun&#8217;s managing system, also available in an open version,</dt>
<dd><p class="first last">using the command qsub)</p>
</dd>
</dl>
</li>
</ul>
<dl class="classmethod">
<dt id="soprano.hpc.submitter.queues.QueueInterface.GridEngine">
<em class="property">classmethod </em><code class="descname">GridEngine</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.queues.QueueInterface.GridEngine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="soprano.hpc.submitter.queues.QueueInterface.LSF">
<em class="property">classmethod </em><code class="descname">LSF</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.queues.QueueInterface.LSF" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.queues.QueueInterface.kill">
<code class="descname">kill</code><span class="sig-paren">(</span><em>job_id</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.queues.QueueInterface.kill" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill the job with the given ID</p>
<div class="line-block">
<div class="line">Args:</div>
<div class="line-block">
<div class="line">job_id (str): ID of the job to kill</div>
<div class="line"><br /></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.queues.QueueInterface.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.queues.QueueInterface.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List all jobs found in the queue</p>
<div class="line-block">
<div class="line">Returns:</div>
<div class="line-block">
<div class="line">jobs (dict): a dict of jobs classified by ID containing all info</div>
<div class="line-block">
<div class="line">that can be matched through list_outre</div>
<div class="line"><br /></div>
</div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.queues.QueueInterface.submit">
<code class="descname">submit</code><span class="sig-paren">(</span><em>script</em>, <em>cwd=None</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.queues.QueueInterface.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit a job to the queue.</p>
<div class="line-block">
<div class="line">Args:</div>
<div class="line-block">
<div class="line">script (str): content of the submission script</div>
<div class="line">cwd (Optional[str]): path to the desired working directory</div>
<div class="line"><br /></div>
</div>
<div class="line">Returns:</div>
<div class="line-block">
<div class="line">job_id (str): the job ID assigned by the queue system and parsed</div>
<div class="line-block">
<div class="line">with sub_outre</div>
</div>
</div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-soprano.hpc.submitter.submit">
<span id="soprano-hpc-submitter-submit-module"></span><h2>soprano.hpc.submitter.submit module<a class="headerlink" href="#module-soprano.hpc.submitter.submit" title="Permalink to this headline">¶</a></h2>
<p>Definition of Submitter class</p>
<p>Base class for all Submitters to inherit from.</p>
<dl class="class">
<dt id="soprano.hpc.submitter.submit.Submitter">
<em class="property">class </em><code class="descclassname">soprano.hpc.submitter.submit.</code><code class="descname">Submitter</code><span class="sig-paren">(</span><em>name</em>, <em>queue</em>, <em>submit_script</em>, <em>max_jobs=4</em>, <em>check_time=10</em>, <em>max_time=3600</em>, <em>temp_folder=None</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Submitter object</p>
<p>Template to derive all specialised Submitters. These are meant to generate,
submit and post-process any number of jobs on a queueing system in the form
of a background process running on a head node. It implements
methods that should be mostly overridden by the child classes.
Six methods define its core behaviour:</p>
<ol class="arabic simple">
<li>next_job is the function that outputs the specification for each new job
to submit. The specification should be a dict with two members, &#8216;name&#8217;
(a string) and &#8216;args&#8217; (ideally a dict). If no more jobs are available
it should return None;</li>
<li>setup_job takes as arguments name, args and folder (a temporary one
created independently) and is supposed to generate the input files
for the job before submission. It returns a boolean, confirming that
the setup went well; if False, the job will be skipped;</li>
<li>check_job takes as arguments job ID, name, args and folder and should
return a bool confirmation of whether the job has finished or not. By
default it simply checks whether the job is still listed in the queue,
however other checks can be implemented in its place;</li>
<li>finish_job takes as arguments name, args and folder and takes care of
the post processing once a job is complete. Here meaningful data should
be extracted and useful files copied to permament locations, as the
temporary folder will be deleted immediately afterwards. It returns
nothing;</li>
<li>start_run takes no arguments, executes at the beginning of a run;</li>
<li>finish_run takes no arguments, executes at the end of a run.</li>
</ol>
<p>In addition, the Submitter takes a template launching script which can
be tagged with keywords, mainly &lt;name&gt; for the job name or any other
arguments present in args. These will be replaced with the appropriate
values when the script is submitted.</p>
<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.check_job">
<code class="descname">check_job</code><span class="sig-paren">(</span><em>job_id</em>, <em>name</em>, <em>args</em>, <em>folder</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.check_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if given job is complete or not</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.finish_job">
<code class="descname">finish_job</code><span class="sig-paren">(</span><em>name</em>, <em>args</em>, <em>folder</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.finish_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs completiion operations on the job. At this point any
relevant output files should be copied from &#8216;folder&#8217; to their final
destination as the temporary folder itself will be deleted immediately
after</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.finish_run">
<code class="descname">finish_run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.finish_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Operations to perform after the daemon thread stops running</p>
</dd></dl>

<dl class="staticmethod">
<dt id="soprano.hpc.submitter.submit.Submitter.list">
<em class="property">static </em><code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.log">
<code class="descname">log</code><span class="sig-paren">(</span><em>logtxt</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.log" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.next_job">
<code class="descname">next_job</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.next_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary definition of the next job in line</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.set_parameters">
<code class="descname">set_parameters</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.set_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Set additional parameters. In this generic example class it has
no arguments, but in specific implementations it will be used to
add more variables without overriding __init__.</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.setup_job">
<code class="descname">setup_job</code><span class="sig-paren">(</span><em>name</em>, <em>args</em>, <em>folder</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.setup_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform preparatory operations on the job</p>
</dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="soprano.hpc.submitter.submit.Submitter.start_run">
<code class="descname">start_run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.start_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Operations to perform when the daemon thread starts running</p>
</dd></dl>

<dl class="staticmethod">
<dt id="soprano.hpc.submitter.submit.Submitter.stop">
<em class="property">static </em><code class="descname">stop</code><span class="sig-paren">(</span><em>fname</em>, <em>subname</em><span class="sig-paren">)</span><a class="headerlink" href="#soprano.hpc.submitter.submit.Submitter.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop Submitter process from filename and name,
return False if failed</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">soprano.hpc.submitter package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-soprano.hpc.submitter.castep">soprano.hpc.submitter.castep module</a></li>
<li><a class="reference internal" href="#module-soprano.hpc.submitter.queues">soprano.hpc.submitter.queues module</a></li>
<li><a class="reference internal" href="#module-soprano.hpc.submitter.submit">soprano.hpc.submitter.submit module</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/soprano.hpc.submitter.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Simone Sturniolo.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/soprano.hpc.submitter.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>